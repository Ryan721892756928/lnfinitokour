<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>InfinitoKour â€“ Infinite Parkour</title>
<style>
body{margin:0;overflow:hidden;background:linear-gradient(#7ec8ff,#bfe9ff);}
canvas{display:block;}
.ui{position:absolute; left:10px; font-family:Arial; color:white; text-shadow:2px 2px 4px black;}
#score{top:10px;font-size:22px;}
#combo{top:40px;}
#time{top:65px;}
#elytra{top:90px;}
#rockets{top:115px;}
#health{top:140px;}
#shop{top:180px;}
.shop-btn{background:rgba(0,0,0,0.5); color:white; border:none; padding:5px 10px; margin-right:5px; cursor:pointer; font-weight:bold; border-radius:5px;}
.shop-btn:hover{background:rgba(0,0,0,0.8);}
#homescreen{position:absolute; top:0; left:0; width:100%; height:100%; background:linear-gradient(#87CEEB,#bfe9ff); display:flex; flex-direction:column; justify-content:center; align-items:center; color:white; font-family:Arial; z-index:10;}
#homescreen button{margin:5px; padding:10px 20px; border:none; border-radius:5px; cursor:pointer; background:#444; color:white;}
#homescreen button:hover{background:#666;}
</style>
</head>
<body>

<div id="homescreen">
    <h1>InfinitoKour</h1>
    <p>Kies je Bal kleur:</p>
    <input type="color" id="ballColor" value="#ff4444">
    <p>Kies je Juggernaut kleur:</p>
    <input type="color" id="jugColor" value="#616161">
    <p>Kies je skin:</p>
    <select id="skinSelect">
        <option value="red">Rood</option>
        <option value="blue">Blauw</option>
        <option value="green">Groen</option>
        <option value="purple">Paars</option>
    </select>
    <button onclick="startGame()">Start Game</button>
</div>

<div class="ui" id="score"></div>
<div class="ui" id="combo"></div>
<div class="ui" id="time"></div>
<div class="ui" id="elytra"></div>
<div class="ui" id="rockets"></div>
<div class="ui" id="health"></div>
<div class="ui" id="shop">
    <button class="shop-btn" onclick="buyUpgrade('rockets')">ðŸš€ Rocket 5c</button>
    <button class="shop-btn" onclick="buyUpgrade('machineGun')">MachineGun 50c</button>
    <button class="shop-btn" onclick="buyUpgrade('juggernaut')">Juggernaut 500c</button>
</div>

<canvas id="c"></canvas>

<script>
const c=document.getElementById("c");
const ctx=c.getContext("2d");
c.width=innerWidth;
c.height=innerHeight;

// ===== CLOUDS & SUN =====
let clouds = [];
for(let i=0;i<15;i++){clouds.push({x:Math.random()*3000,y:50+Math.random()*200,s:0.5+Math.random()*0.5});}
let sun = {x:100,y:100,r:50};

let gameStarted = false;
function startGame(){
    gameStarted = true;
    document.getElementById("homescreen").style.display="none";
    player.color = document.getElementById("ballColor").value;
    upgrades.juggernaut.color = document.getElementById("jugColor").value;
}

// ===== GLOBAL =====
const GRAVITY=0.8;
let cameraX=0,cameraY=0,keys={},mouse={x:0,y:0,down:false};
let startTime=Date.now();
let score=0,combo=0,comboTimer=0,coins=0;

let player={x:100,y:0,r:22,vx:0,vy:0,speed:7,jump:16,grounded:false,jumps:2,flying:false,hp:100,maxHp:100,reload:0,color:'#ff4444'};
let rockets=5,elytraTime=0;

let platforms=[],movingPlatforms=[],spikes=[],enemies=[],bullets=[],enemyBullets=[],particles=[],powerUps=[];

// ===== PLATFORM =====
class Platform{
    constructor(x,y,w){this.x=x;this.y=y;this.w=w;this.h=22;}
    draw(){ctx.fillStyle='#3cb371';ctx.fillRect(this.x,this.y,this.w,this.h);}
}

// ===== MOVING PLATFORM =====
class MovingPlatform{
    constructor(x,y,w,range,speed){this.x=x;this.y=y;this.w=w;this.h=22;this.range=range;this.speed=speed;this.startX=x;this.dir=1;}
    update(){this.x += this.speed*this.dir; if(this.x>this.startX+this.range || this.x<this.startX) this.dir*=-1;}
    draw(){ctx.fillStyle='#66cdaa';ctx.fillRect(this.x,this.y,this.w,this.h);}
}

// ===== SPIKES =====
class Spike{
    constructor(x,y,w){
        this.x=x; this.y=y; this.w=w||20; this.h=20; this.offset=Math.random()*10;
    }
    draw(){
        ctx.fillStyle='grey'; 
        ctx.beginPath(); 
        for(let i=0;i<this.w;i+=20){
            ctx.moveTo(this.x+i,this.y); 
            ctx.lineTo(this.x+i+10,this.y-20-this.offset*Math.sin(Date.now()/200));
            ctx.lineTo(this.x+i+20,this.y);
            ctx.fill();
        }
    }
}

// ===== POWERUP =====
class PowerUp{constructor(x,y,type){this.x=x;this.y=y;this.type=type;this.r=12;}
draw(){ctx.fillStyle=this.type==="coin"?"gold":"cyan";ctx.beginPath();ctx.arc(this.x,this.y,this.r,0,Math.PI*2);ctx.fill();}}

// ===== ENEMY =====
class Enemy{
    constructor(x,y,type){this.x=x;this.y=y;this.type=type;this.r=type===2?26:20;this.hp=type===2?6:type===1?2:3;this.reload=80;}
    update(){
        if(this.type===1) this.x+=Math.sign(player.x-this.x)*1.2;
        let dx=player.x-this.x,dy=player.y-this.y,dist=Math.hypot(dx,dy);
        if(dist<500 && this.reload--<=0){enemyBullets.push({x:this.x,y:this.y,vx:dx/dist*6,vy:dy/dist*6});this.reload=100;}
    }
    draw(){ctx.fillStyle=this.type===2?'#2e86de':this.type===1?'#e74c3c':'purple';
        ctx.beginPath();ctx.arc(this.x,this.y,this.r,0,Math.PI*2);ctx.fill();}
}

// ===== UPGRADES =====
let upgrades = {
    rockets:{cost:5,amount:1},
    machineGun:{cost:50,active:false,duration:1200},
    juggernaut:{cost:500,active:false,resistance:0.5,color:'#616161'}
};
let machineGunTimer=0;
function buyUpgrade(type){if(coins>=upgrades[type].cost){coins-=upgrades[type].cost;if(type==="rockets") rockets+=upgrades[type].amount;if(type==="machineGun") upgrades.machineGun.active=true;if(type==="juggernaut") upgrades.juggernaut.active=true;}}

// ===== INIT PLATFORMEN =====
let lastX=0,lastY=c.height-150;
platforms.push(new Platform(0,lastY,400));
player.y=lastY-player.r*2; lastX=400;

function genPlat(){
    let gap=150+Math.random()*150;
    let w=150+Math.random()*150;
    let x=lastX+gap;
    let y=lastY-(90+Math.random()*130);
    if(Math.random()<0.2) movingPlatforms.push(new MovingPlatform(x,y,w,100,2));
    else platforms.push(new Platform(x,y,w));

    if(Math.random()<0.5){
        let spikeCount = 1 + Math.floor(Math.random()*3);
        for(let i=0;i<spikeCount;i++){
            let sx = x + Math.random()*w-30;
            spikes.push(new Spike(sx,y));
        }
    }

    if(Math.random()<0.25) powerUps.push(new PowerUp(x+w/2,y-25,Math.random()<0.5?"coin":"speed"));
    if(Math.random()<0.3){
        let t=Math.random()<0.3?2:Math.random()<0.5?1:0;
        enemies.push(new Enemy(x+w/2,y-50,t));
    }
    lastX=x+w; lastY=y;
}
for(let i=0;i<12;i++) genPlat();

// ===== INPUT =====
addEventListener("keydown",e=>{if(!gameStarted) return;if(e.code==='Space'||e.code==='KeyW') jump();if(e.code==='KeyE'&&rockets>0){rockets--;elytraTime=180;}keys[e.code]=true;});
addEventListener("keyup",e=>{if(!gameStarted) return; keys[e.code]=false;});
addEventListener("mousemove",e=>{if(!gameStarted) return; mouse.x=e.clientX;mouse.y=e.clientY;});
addEventListener("mousedown",()=>{if(!gameStarted) return; mouse.down=true;});
addEventListener("mouseup",()=>{if(!gameStarted) return; mouse.down=false;});

function jump(){if(player.flying) return;if(player.grounded){player.vy=-player.jump;player.jumps=1;}else if(player.jumps>0){player.vy=-player.jump;player.jumps--;}}  

// ===== SCORE AFSTAND =====
let lastScoreX = player.x;
function updateScoreDistance(){let dx=player.x-lastScoreX;if(dx>0){score+=Math.floor(dx*0.5);lastScoreX=player.x;}}

// ===== UPDATE =====
function update(){
    if(!gameStarted) return;
    updateScoreDistance();

    // Elytra
    if(elytraTime>0){player.flying=true;elytraTime--; if(keys.KeyA) player.x-=player.speed;if(keys.KeyD) player.x+=player.speed;if(keys.KeyW) player.y-=player.speed;if(keys.KeyS) player.y+=player.speed;if(particles.length<80)particles.push({x:player.x,y:player.y+20,life:20});}
    else{player.flying=false;player.vx=0;if(keys.KeyA) player.vx=-player.speed;if(keys.KeyD) player.vx=player.speed;player.vy+=GRAVITY;player.x+=player.vx;player.y+=player.vy;}

    // Platforms collision
    player.grounded=false;
    platforms.concat(movingPlatforms).forEach(p=>{
        if(player.x+player.r>p.x && player.x-player.r<p.x+p.w &&
           player.y+player.r*2>p.y && player.y<p.y+p.h && player.vy>=0){
            player.y=p.y-player.r*2; player.vy=0; player.grounded=true; player.jumps=2;
        }
    });
    movingPlatforms.forEach(mp=>mp.update());
    cameraX=player.x-c.width/3; cameraY=player.y-c.height/2;
    while(lastX-cameraX<c.width*2) genPlat();

    // Shooting & machineGun
    if(mouse.down && player.reload<=0){let dx=mouse.x+cameraX-player.x,dy=mouse.y+cameraY-player.y;let d=Math.hypot(dx,dy)||1; bullets.push({x:player.x,y:player.y,vx:dx/d*10,vy:dy/d*10});player.reload=15;}else player.reload--;
    if(upgrades.machineGun.active){machineGunTimer++;if(machineGunTimer%3===0) bullets.push({x:player.x,y:player.y,vx:10,vy:0});if(machineGunTimer>upgrades.machineGun.duration){upgrades.machineGun.active=false; machineGunTimer=0;}}

    bullets.forEach((b,i)=>{b.x+=b.vx;b.y+=b.vy;enemies.forEach((e,ei)=>{let dx=b.x-e.x,dy=b.y-e.y;if(dx*dx+dy*dy<e.r*e.r){e.hp--;b.hit=true;combo++;comboTimer=60;if(e.hp<=0){score+=100;coins+=10;player.hp=Math.min(player.hp+5,100);enemies.splice(ei,1);}}});});
    bullets=bullets.filter(b=>!b.hit).slice(-50);

    enemies.forEach(e=>e.update());
    enemyBullets.forEach((b,i)=>{b.x+=b.vx;b.y+=b.vy;let dx=player.x-b.x,dy=player.y-b.y;if(dx*dx+dy*dy<player.r*player.r){let dmg=upgrades.juggernaut.active?0.5:1;player.hp-=dmg;enemyBullets.splice(i,1);}});

    particles=particles.filter(p=>p.life-->0);

    // Spikes damage
    spikes.forEach(s=>{if(player.x>s.x && player.x<s.x+s.w && player.y+player.r> s.y-20 && player.y+player.r< s.y){player.hp-=1;}});

    powerUps=powerUps.filter(p=>{let dx=player.x-p.x,dy=player.y-p.y;if(dx*dx+dy*dy<(player.r+p.r)**2){if(p.type==="coin") coins+=5;if(p.type==="speed") player.speed+=0.3;return false;}return true;});
    if(comboTimer--<=0) combo=0;

    // ===== GAME OVER CHECK =====
    if(player.hp <= 0){
        gameStarted = false;
        document.getElementById("homescreen").style.display = "flex";
        player.hp = 100;
        player.x = 100;
        player.y = lastY - player.r*2;
        player.vx = 0;
        player.vy = 0;
        coins = 0;
        score = 0;
        combo = 0;
        rockets = 5;
        enemies = [];
        bullets = [];
        enemyBullets = [];
        spikes = [];
        powerUps = [];
        movingPlatforms = [];
        lastX = 400;
        for(let i=0;i<12;i++) genPlat();
    }

    document.getElementById("score").innerText="Score: "+Math.floor(score);
    document.getElementById("combo").innerText="Combo: x"+combo;
    document.getElementById("time").innerText="Time: "+Math.floor((Date.now()-startTime)/1000)+"s";
    document.getElementById("elytra").innerText=elytraTime>0?"Elytra: ON":"Elytra: OFF";
    document.getElementById("rockets").innerText="ðŸš€ Rockets: "+rockets;
    document.getElementById("health").innerText="Health: "+Math.floor(player.hp)+"/"+player.maxHp+" | Coins: "+coins;
}

// ===== DRAW =====
function draw(){
    ctx.clearRect(0,0,c.width,c.height);

    // achtergrond
    ctx.fillStyle="yellow"; ctx.beginPath(); ctx.arc(sun.x,sun.y,sun.r,0,Math.PI*2); ctx.fill();
    clouds.forEach(cloud=>{
        ctx.fillStyle="white"; 
        ctx.beginPath(); 
        ctx.arc(cloud.x-cloud.s*10,cloud.y,30*cloud.s,0,Math.PI*2);
        ctx.arc(cloud.x,cloud.y,40*cloud.s,0,Math.PI*2);
        ctx.arc(cloud.x+cloud.s*10,cloud.y,30*cloud.s,0,Math.PI*2); 
        ctx.fill();
        cloud.x-=0.2; 
        if(cloud.x<-100) cloud.x=c.width+100;
    });

    if(!gameStarted) return;

    ctx.save(); 
    ctx.translate(-cameraX,-cameraY);

    platforms.forEach(p=>p.draw());
    movingPlatforms.forEach(mp=>mp.draw());
    spikes.forEach(s=>s.draw());
    enemies.forEach(e=>e.draw());
    powerUps.forEach(p=>p.draw());

    bullets.forEach(b=>{ctx.fillStyle='yellow';ctx.beginPath();ctx.arc(b.x,b.y,5,0,Math.PI*2);ctx.fill();});
    enemyBullets.forEach(b=>{ctx.fillStyle='red';ctx.beginPath();ctx.arc(b.x,b.y,5,0,Math.PI*2);ctx.fill();});
    particles.forEach(p=>{ctx.fillStyle='rgba(200,200,200,0.4)';ctx.beginPath();ctx.arc(p.x,p.y,6,0,Math.PI*2);ctx.fill();});

    if(player.flying){ctx.strokeStyle='white';ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(player.x-20,player.y+15);ctx.lineTo(player.x-45,player.y+5);ctx.moveTo(player.x+20,player.y+15);ctx.lineTo(player.x+45,player.y+5);ctx.stroke();}
    ctx.fillStyle=upgrades.juggernaut.active?upgrades.juggernaut.color:player.color;
    ctx.beginPath(); ctx.arc(player.x,player.y+player.r,player.r,0,Math.PI*2); ctx.fill();

    ctx.restore();
}

function loop(){update();draw();requestAnimationFrame(loop);}
loop();
</script>

</body>
</html>
